<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Viewer</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="env.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js"></script>
    <script src="firebase.js"></script>
</head>
<body>
    <div id="viewer-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const docUrl = urlParams.get('docUrl');

            if (!localStorage.getItem('email')) {
                alert('Please visit the main page and enter your email to access the documents.');
                window.location.href = 'index.html';
                return;
            }

            if (docUrl) {
                document.getElementById('viewer-container').innerHTML = `
                    <iframe src="${docUrl}" width="100%" height="100%" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
                `;
                const startTime = Date.now();

                window.addEventListener('beforeunload', () => {
                    const endTime = Date.now();
                    const timeSpent = endTime - startTime;

                    window.db.collection('pageViews').add({
                        email: localStorage.getItem('email'),
                        docUrl,
                        timeSpent,
                        timestamp: new Date()
                    });
                });
            } else {
                alert('No document URL provided.');
            }
        });
    </script>
</body>
</html>
